# AIçŸ­å‰§è‡ªåŠ¨åŒ–ç”Ÿæˆç³»ç»Ÿå¼€å‘æ•™ç¨‹ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
## ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸ç¯å¢ƒå‡†å¤‡

---

## ç›®å½•

1. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#1-ç³»ç»Ÿæ¶æ„è®¾è®¡)
   - 1.1 [æ•´ä½“æµç¨‹å›¾](#11-æ•´ä½“æµç¨‹å›¾)
   - 1.2 [Agentæ¶æ„è®¾è®¡](#12-agentæ¶æ„è®¾è®¡)
   - 1.3 [æŠ€æœ¯é€‰å‹è¯´æ˜](#13-æŠ€æœ¯é€‰å‹è¯´æ˜)
2. [ç¯å¢ƒå‡†å¤‡](#2-ç¯å¢ƒå‡†å¤‡)
   - 2.1 [å¼€å‘ç¯å¢ƒé…ç½®](#21-å¼€å‘ç¯å¢ƒé…ç½®)
   - 2.2 [APIå¯†é’¥é…ç½®](#22-apiå¯†é’¥é…ç½®)
   - 2.3 [é¡¹ç›®ç»“æ„](#23-é¡¹ç›®ç»“æ„)

---

## 1. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 1.1 æ•´ä½“æµç¨‹å›¾

AIçŸ­å‰§è‡ªåŠ¨åŒ–ç”Ÿæˆç³»ç»Ÿçš„æ ¸å¿ƒæµç¨‹åŒ…æ‹¬ä»å‰§æœ¬è¾“å…¥åˆ°æœ€ç»ˆè§†é¢‘è¾“å‡ºçš„å®Œæ•´é“¾è·¯ã€‚ä»¥ä¸‹æ˜¯ç³»ç»Ÿçš„æ•´ä½“æ•°æ®æµï¼š

```mermaid
graph TB
    A[å‰§æœ¬è¾“å…¥] --> B[å‰§æœ¬è§£æAgent]
    B --> C[åˆ†é•œè„šæœ¬ç”Ÿæˆ]
    C --> D[å›¾ç‰‡ç”ŸæˆAgent<br/>Nano Banana Pro]
    D --> E[åˆ†é•œå›¾ç‰‡é›†åˆ]
    E --> F[è§†é¢‘ç”ŸæˆAgent<br/>Veo3 API]
    F --> G[è§†é¢‘ç‰‡æ®µé›†åˆ]
    G --> H[è§†é¢‘åˆæˆAgent]
    H --> I[åæœŸå¤„ç†<br/>è½¬åœº/éŸ³æ•ˆ/å­—å¹•]
    I --> J[æœ€ç»ˆè§†é¢‘è¾“å‡º]

    K[ä¸»æ§Agentåè°ƒå™¨] -.ç›‘æ§.-> B
    K -.ç›‘æ§.-> D
    K -.ç›‘æ§.-> F
    K -.ç›‘æ§.-> H

    L[çŠ¶æ€ç®¡ç†å™¨] --> K
    M[é”™è¯¯å¤„ç†å™¨] --> K
    N[è¿›åº¦å›è°ƒ] --> K
```

**æ•°æ®æµè¯¦è§£ï¼š**

1. **è¾“å…¥é˜¶æ®µ**ï¼šç”¨æˆ·æä¾›å‰§æœ¬æ–‡æœ¬ï¼ˆtxt/jsonæ ¼å¼ï¼‰
2. **è§£æé˜¶æ®µ**ï¼šå‰§æœ¬è§£æAgentå°†æ–‡æœ¬è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ï¼ˆåœºæ™¯ã€è§’è‰²ã€å¯¹è¯ã€é•œå¤´æè¿°ï¼‰
3. **å›¾ç‰‡ç”Ÿæˆé˜¶æ®µ**ï¼šå›¾ç‰‡ç”ŸæˆAgentè°ƒç”¨Nano Banana Pro APIï¼Œä¸ºæ¯ä¸ªåˆ†é•œç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡
4. **è§†é¢‘ç”Ÿæˆé˜¶æ®µ**ï¼šè§†é¢‘ç”ŸæˆAgentè°ƒç”¨Veo3 APIï¼Œå°†é™æ€å›¾ç‰‡è½¬æ¢ä¸ºåŠ¨æ€è§†é¢‘ç‰‡æ®µ
5. **åˆæˆé˜¶æ®µ**ï¼šè§†é¢‘åˆæˆAgentä½¿ç”¨FFmpeg/MoviePyæ‹¼æ¥æ‰€æœ‰ç‰‡æ®µ
6. **åæœŸå¤„ç†é˜¶æ®µ**ï¼šæ·»åŠ è½¬åœºæ•ˆæœã€èƒŒæ™¯éŸ³ä¹ã€å­—å¹•ç­‰
7. **è¾“å‡ºé˜¶æ®µ**ï¼šå¯¼å‡ºæœ€ç»ˆçš„å®Œæ•´çŸ­å‰§è§†é¢‘

---

### 1.2 Agentæ¶æ„è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨**å¤šAgentåä½œæ¶æ„**ï¼Œæ¯ä¸ªAgentè´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½æ¨¡å—ï¼Œé€šè¿‡ä¸»æ§Agentè¿›è¡Œç»Ÿä¸€è°ƒåº¦ã€‚

#### 1.2.1 Agentè§’è‰²å®šä¹‰

```python
# Agentè§’è‰²æšä¸¾
from enum import Enum

class AgentRole(Enum):
    """Agentè§’è‰²å®šä¹‰"""
    SCRIPT_PARSER = "script_parser"           # å‰§æœ¬è§£æAgent
    IMAGE_GENERATOR = "image_generator"       # å›¾ç‰‡ç”ŸæˆAgent
    VIDEO_GENERATOR = "video_generator"       # è§†é¢‘ç”ŸæˆAgent
    VIDEO_COMPOSER = "video_composer"         # è§†é¢‘åˆæˆAgent
    ORCHESTRATOR = "orchestrator"             # ä¸»æ§åè°ƒAgent
```

#### 1.2.2 AgentèŒè´£åˆ’åˆ†

| Agentåç§° | èŒè´£æè¿° | è¾“å…¥ | è¾“å‡º |
|-----------|---------|------|------|
| **å‰§æœ¬è§£æAgent** | è§£æå‰§æœ¬æ–‡æœ¬ï¼Œç”Ÿæˆç»“æ„åŒ–åˆ†é•œè„šæœ¬ | åŸå§‹å‰§æœ¬æ–‡æœ¬ | åˆ†é•œåœºæ™¯åˆ—è¡¨ï¼ˆJSONï¼‰ |
| **å›¾ç‰‡ç”ŸæˆAgent** | è°ƒç”¨Nano Banana Proç”Ÿæˆåˆ†é•œå›¾ç‰‡ | åœºæ™¯æè¿°ã€é£æ ¼å‚æ•° | å›¾ç‰‡æ–‡ä»¶è·¯å¾„åˆ—è¡¨ |
| **è§†é¢‘ç”ŸæˆAgent** | è°ƒç”¨Veo3å°†å›¾ç‰‡è½¬æ¢ä¸ºè§†é¢‘ç‰‡æ®µ | å›¾ç‰‡è·¯å¾„ã€åœºæ™¯é…ç½® | è§†é¢‘ç‰‡æ®µè·¯å¾„åˆ—è¡¨ |
| **è§†é¢‘åˆæˆAgent** | æ‹¼æ¥è§†é¢‘ç‰‡æ®µå¹¶è¿›è¡ŒåæœŸå¤„ç† | è§†é¢‘ç‰‡æ®µåˆ—è¡¨ã€éŸ³é¢‘ã€å­—å¹• | æœ€ç»ˆè§†é¢‘æ–‡ä»¶è·¯å¾„ |
| **ä¸»æ§Agent** | åè°ƒæ‰€æœ‰Agentçš„æ‰§è¡Œï¼Œç®¡ç†çŠ¶æ€ | ç”¨æˆ·é…ç½®ã€è¿›åº¦å›è°ƒ | æ‰§è¡Œç»“æœã€çŠ¶æ€ä¿¡æ¯ |

#### 1.2.3 AgentåŸºç¡€æ¶æ„

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, Optional
from datetime import datetime
import logging

class BaseAgent(ABC):
    """AgentåŸºç±»ï¼Œå®šä¹‰æ‰€æœ‰Agentçš„é€šç”¨æ¥å£"""

    def __init__(self, agent_id: str, config: Dict[str, Any]):
        """
        åˆå§‹åŒ–Agent

        Args:
            agent_id: Agentå”¯ä¸€æ ‡è¯†ç¬¦
            config: Agenté…ç½®å‚æ•°
        """
        self.agent_id = agent_id
        self.config = config
        self.logger = logging.getLogger(f"Agent.{agent_id}")
        self.state = AgentState.IDLE
        self.created_at = datetime.now()

    @abstractmethod
    async def execute(self, input_data: Any) -> Any:
        """
        æ‰§è¡ŒAgentçš„æ ¸å¿ƒä»»åŠ¡

        Args:
            input_data: è¾“å…¥æ•°æ®

        Returns:
            å¤„ç†åçš„è¾“å‡ºæ•°æ®
        """
        pass

    @abstractmethod
    async def validate_input(self, input_data: Any) -> bool:
        """
        éªŒè¯è¾“å…¥æ•°æ®çš„æœ‰æ•ˆæ€§

        Args:
            input_data: å¾…éªŒè¯çš„è¾“å…¥æ•°æ®

        Returns:
            éªŒè¯æ˜¯å¦é€šè¿‡
        """
        pass

    async def on_error(self, error: Exception) -> None:
        """
        é”™è¯¯å¤„ç†é’©å­

        Args:
            error: å‘ç”Ÿçš„å¼‚å¸¸
        """
        self.logger.error(f"Agent {self.agent_id} encountered error: {str(error)}")
        self.state = AgentState.ERROR

    async def on_complete(self, result: Any) -> None:
        """
        ä»»åŠ¡å®Œæˆé’©å­

        Args:
            result: æ‰§è¡Œç»“æœ
        """
        self.logger.info(f"Agent {self.agent_id} completed successfully")
        self.state = AgentState.COMPLETED

class AgentState(Enum):
    """AgentçŠ¶æ€æšä¸¾"""
    IDLE = "idle"               # ç©ºé—²
    RUNNING = "running"         # è¿è¡Œä¸­
    WAITING = "waiting"         # ç­‰å¾…ä¸­
    COMPLETED = "completed"     # å·²å®Œæˆ
    ERROR = "error"             # é”™è¯¯çŠ¶æ€
```

#### 1.2.4 Agentåä½œæœºåˆ¶

Agentä¹‹é—´é€šè¿‡**æ¶ˆæ¯é˜Ÿåˆ—**è¿›è¡Œé€šä¿¡ï¼Œä¸»æ§Agentè´Ÿè´£æ¶ˆæ¯çš„è·¯ç”±å’Œè°ƒåº¦ï¼š

```python
import asyncio
from typing import Callable, Dict, List
from dataclasses import dataclass

@dataclass
class AgentMessage:
    """Agenté—´é€šä¿¡çš„æ¶ˆæ¯æ ¼å¼"""
    sender_id: str          # å‘é€è€…Agent ID
    receiver_id: str        # æ¥æ”¶è€…Agent ID
    message_type: str       # æ¶ˆæ¯ç±»å‹ï¼ˆtask/result/error/statusï¼‰
    payload: Any            # æ¶ˆæ¯å†…å®¹
    timestamp: datetime     # æ—¶é—´æˆ³
    correlation_id: str     # å…³è”IDï¼ˆç”¨äºè¿½è¸ªè¯·æ±‚é“¾è·¯ï¼‰

class MessageBus:
    """æ¶ˆæ¯æ€»çº¿ï¼Œè´Ÿè´£Agenté—´çš„æ¶ˆæ¯ä¼ é€’"""

    def __init__(self):
        self.subscribers: Dict[str, List[Callable]] = {}
        self.message_queue = asyncio.Queue()

    def subscribe(self, message_type: str, callback: Callable):
        """
        è®¢é˜…ç‰¹å®šç±»å‹çš„æ¶ˆæ¯

        Args:
            message_type: æ¶ˆæ¯ç±»å‹
            callback: å›è°ƒå‡½æ•°
        """
        if message_type not in self.subscribers:
            self.subscribers[message_type] = []
        self.subscribers[message_type].append(callback)

    async def publish(self, message: AgentMessage):
        """
        å‘å¸ƒæ¶ˆæ¯

        Args:
            message: è¦å‘å¸ƒçš„æ¶ˆæ¯
        """
        await self.message_queue.put(message)

    async def start_processing(self):
        """å¯åŠ¨æ¶ˆæ¯å¤„ç†å¾ªç¯"""
        while True:
            message = await self.message_queue.get()
            if message.message_type in self.subscribers:
                for callback in self.subscribers[message.message_type]:
                    await callback(message)
```

#### 1.2.5 çŠ¶æ€ç®¡ç†ç­–ç•¥

ä½¿ç”¨**çŠ¶æ€æœºæ¨¡å¼**ç®¡ç†æ•´ä¸ªç”Ÿæˆæµç¨‹çš„çŠ¶æ€ï¼š

```python
from enum import Enum
from typing import Optional

class WorkflowState(Enum):
    """å·¥ä½œæµçŠ¶æ€"""
    INITIALIZED = "initialized"           # å·²åˆå§‹åŒ–
    PARSING_SCRIPT = "parsing_script"     # è§£æå‰§æœ¬ä¸­
    GENERATING_IMAGES = "generating_images"  # ç”Ÿæˆå›¾ç‰‡ä¸­
    GENERATING_VIDEOS = "generating_videos"  # ç”Ÿæˆè§†é¢‘ä¸­
    COMPOSING_VIDEO = "composing_video"   # åˆæˆè§†é¢‘ä¸­
    POST_PROCESSING = "post_processing"   # åæœŸå¤„ç†ä¸­
    COMPLETED = "completed"               # å·²å®Œæˆ
    FAILED = "failed"                     # å¤±è´¥

class WorkflowStateManager:
    """å·¥ä½œæµçŠ¶æ€ç®¡ç†å™¨"""

    def __init__(self):
        self.current_state = WorkflowState.INITIALIZED
        self.state_history = [(WorkflowState.INITIALIZED, datetime.now())]
        self.checkpoint_data = {}

    def transition_to(self, new_state: WorkflowState,
                     checkpoint: Optional[Dict] = None):
        """
        çŠ¶æ€è½¬æ¢

        Args:
            new_state: æ–°çŠ¶æ€
            checkpoint: æ£€æŸ¥ç‚¹æ•°æ®ï¼ˆç”¨äºæ–­ç‚¹ç»­ä¼ ï¼‰
        """
        if self._is_valid_transition(self.current_state, new_state):
            self.current_state = new_state
            self.state_history.append((new_state, datetime.now()))

            if checkpoint:
                self.checkpoint_data[new_state.value] = checkpoint
        else:
            raise ValueError(f"Invalid state transition: {self.current_state} -> {new_state}")

    def _is_valid_transition(self, from_state: WorkflowState,
                            to_state: WorkflowState) -> bool:
        """éªŒè¯çŠ¶æ€è½¬æ¢æ˜¯å¦åˆæ³•"""
        valid_transitions = {
            WorkflowState.INITIALIZED: [WorkflowState.PARSING_SCRIPT],
            WorkflowState.PARSING_SCRIPT: [WorkflowState.GENERATING_IMAGES, WorkflowState.FAILED],
            WorkflowState.GENERATING_IMAGES: [WorkflowState.GENERATING_VIDEOS, WorkflowState.FAILED],
            WorkflowState.GENERATING_VIDEOS: [WorkflowState.COMPOSING_VIDEO, WorkflowState.FAILED],
            WorkflowState.COMPOSING_VIDEO: [WorkflowState.POST_PROCESSING, WorkflowState.FAILED],
            WorkflowState.POST_PROCESSING: [WorkflowState.COMPLETED, WorkflowState.FAILED],
        }

        return to_state in valid_transitions.get(from_state, [])

    def get_checkpoint(self, state: WorkflowState) -> Optional[Dict]:
        """è·å–ç‰¹å®šçŠ¶æ€çš„æ£€æŸ¥ç‚¹æ•°æ®"""
        return self.checkpoint_data.get(state.value)
```

#### 1.2.6 é”™è¯¯å¤„ç†ç­–ç•¥

å®ç°**å¤šå±‚æ¬¡é”™è¯¯å¤„ç†æœºåˆ¶**ï¼š

```python
import traceback
from typing import Type, Callable, Optional

class ErrorHandler:
    """ç»Ÿä¸€é”™è¯¯å¤„ç†å™¨"""

    def __init__(self):
        self.error_handlers: Dict[Type[Exception], Callable] = {}
        self.retry_config = {
            'max_retries': 3,
            'backoff_factor': 2,
            'retry_exceptions': [ConnectionError, TimeoutError]
        }

    def register_handler(self, exception_type: Type[Exception],
                        handler: Callable):
        """
        æ³¨å†Œç‰¹å®šå¼‚å¸¸çš„å¤„ç†å™¨

        Args:
            exception_type: å¼‚å¸¸ç±»å‹
            handler: å¤„ç†å‡½æ•°
        """
        self.error_handlers[exception_type] = handler

    async def handle_error(self, error: Exception,
                          context: Optional[Dict] = None) -> Any:
        """
        å¤„ç†é”™è¯¯

        Args:
            error: å‘ç”Ÿçš„å¼‚å¸¸
            context: é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯

        Returns:
            å¤„ç†ç»“æœï¼ˆå¦‚é‡è¯•ã€é™çº§æ–¹æ¡ˆç­‰ï¼‰
        """
        error_type = type(error)

        # æŸ¥æ‰¾åŒ¹é…çš„é”™è¯¯å¤„ç†å™¨
        if error_type in self.error_handlers:
            return await self.error_handlers[error_type](error, context)

        # é»˜è®¤é”™è¯¯å¤„ç†ï¼šè®°å½•æ—¥å¿—å¹¶æŠ›å‡º
        logging.error(f"Unhandled error: {error}")
        logging.error(f"Traceback: {traceback.format_exc()}")
        logging.error(f"Context: {context}")
        raise error

# ä½¿ç”¨ç¤ºä¾‹
async def handle_api_timeout(error: TimeoutError, context: Dict):
    """å¤„ç†APIè¶…æ—¶é”™è¯¯"""
    retry_count = context.get('retry_count', 0)
    max_retries = context.get('max_retries', 3)

    if retry_count < max_retries:
        wait_time = 2 ** retry_count  # æŒ‡æ•°é€€é¿
        await asyncio.sleep(wait_time)
        return {'action': 'retry', 'wait_time': wait_time}
    else:
        return {'action': 'fail', 'reason': 'Max retries exceeded'}
```

---

### 1.3 æŠ€æœ¯é€‰å‹è¯´æ˜

#### 1.3.1 ç¼–ç¨‹è¯­è¨€ï¼šPython 3.8+

**é€‰æ‹©ç†ç”±ï¼š**
- ä¸°å¯Œçš„AI/MLç”Ÿæ€ç³»ç»Ÿï¼ˆNumPyã€Pillowç­‰ï¼‰
- ä¼˜ç§€çš„å¼‚æ­¥ç¼–ç¨‹æ”¯æŒï¼ˆasyncioã€aiohttpï¼‰
- å¼ºå¤§çš„è§†é¢‘å¤„ç†åº“ï¼ˆMoviePyã€FFmpeg-pythonï¼‰
- ç®€æ´çš„è¯­æ³•ï¼Œä¾¿äºå¿«é€Ÿå¼€å‘å’Œè¿­ä»£

#### 1.3.2 Agentæ¡†æ¶é€‰å‹

æˆ‘ä»¬å°†å®ç°**è‡ªå®šä¹‰è½»é‡çº§Agentæ¡†æ¶**ï¼ŒåŸå› å¦‚ä¸‹ï¼š

| æ¡†æ¶ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ˜¯å¦é‡‡ç”¨ |
|------|------|------|---------|
| **LangChain** | ç”Ÿæ€ä¸°å¯Œã€æ–‡æ¡£å®Œå–„ | è¿‡äºé‡é‡çº§ã€å­¦ä¹ æ›²çº¿é™¡å³­ | âŒ |
| **AutoGen** | å¤šAgentåä½œèƒ½åŠ›å¼º | ä¾èµ–OpenAI APIã€é…ç½®å¤æ‚ | âŒ |
| **è‡ªå®šä¹‰æ¡†æ¶** | è½»é‡çµæ´»ã€å¯æ§æ€§å¼º | éœ€è¦è‡ªè¡Œå®ç°åŸºç¡€è®¾æ–½ | âœ… |

**è‡ªå®šä¹‰æ¡†æ¶çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- ç²¾ç®€çš„ä¾èµ–ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
- é’ˆå¯¹è§†é¢‘ç”Ÿæˆåœºæ™¯æ·±åº¦ä¼˜åŒ–
- ä¾¿äºé›†æˆç‰¹å®šçš„AIæœåŠ¡ï¼ˆNano Banana Proã€Veo3ï¼‰
- æ›´å¥½çš„æ€§èƒ½å’Œèµ„æºæ§åˆ¶

#### 1.3.3 è§†é¢‘å¤„ç†åº“é€‰å‹

é‡‡ç”¨**FFmpeg + MoviePyç»„åˆæ–¹æ¡ˆ**ï¼š

```python
# FFmpegï¼šåº•å±‚è§†é¢‘å¤„ç†
# - é«˜æ€§èƒ½ã€åŠŸèƒ½å¼ºå¤§
# - é€‚åˆæ‰¹é‡å¤„ç†å’Œå¤æ‚è½¬ç 

# MoviePyï¼šPythoné«˜çº§æ¥å£
# - ç®€æ´çš„APIã€æ˜“äºä½¿ç”¨
# - é€‚åˆè§†é¢‘åˆæˆå’Œç‰¹æ•ˆå¤„ç†

# ç»„åˆä½¿ç”¨ç¤ºä¾‹
import ffmpeg
from moviepy.editor import VideoFileClip, concatenate_videoclips

# FFmpegç”¨äºå¿«é€Ÿè½¬ç 
def convert_format(input_path, output_path):
    stream = ffmpeg.input(input_path)
    stream = ffmpeg.output(stream, output_path, vcodec='libx264')
    ffmpeg.run(stream)

# MoviePyç”¨äºè§†é¢‘åˆæˆ
def merge_videos(video_paths, output_path):
    clips = [VideoFileClip(p) for p in video_paths]
    final = concatenate_videoclips(clips, method="compose")
    final.write_videofile(output_path)
```

#### 1.3.4 HTTPè¯·æ±‚åº“é€‰å‹

é‡‡ç”¨**httpxï¼ˆæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ï¼‰**ï¼š

```python
import httpx

# ä¼˜åŠ¿ï¼š
# 1. åŒæ—¶æ”¯æŒsyncå’Œasync
# 2. HTTP/2æ”¯æŒ
# 3. æ›´å¥½çš„æ€§èƒ½å’Œè¶…æ—¶æ§åˆ¶

async def async_api_call():
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "https://api.example.com/generate",
            json={"prompt": "scene description"},
            timeout=30.0
        )
        return response.json()
```

#### 1.3.5 å¼‚æ­¥å¤„ç†æ–¹æ¡ˆ

ä½¿ç”¨**asyncio + aiohttp**å®ç°é«˜å¹¶å‘ï¼š

```python
import asyncio
import aiohttp

async def batch_generate_images(prompts: List[str]):
    """å¹¶å‘ç”Ÿæˆå¤šå¼ å›¾ç‰‡"""
    async with aiohttp.ClientSession() as session:
        tasks = [
            generate_single_image(session, prompt)
            for prompt in prompts
        ]
        results = await asyncio.gather(*tasks)
        return results

# ä¼˜åŠ¿ï¼š
# - é«˜å¹¶å‘å¤„ç†ï¼ˆIOå¯†é›†å‹ä»»åŠ¡ï¼‰
# - é™ä½APIè°ƒç”¨æ€»è€—æ—¶
# - æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡
```

---

## 2. ç¯å¢ƒå‡†å¤‡

### 2.1 å¼€å‘ç¯å¢ƒé…ç½®

#### 2.1.1 Pythonç‰ˆæœ¬è¦æ±‚

**æ¨èç‰ˆæœ¬ï¼šPython 3.9+**ï¼ˆæœ€ä½è¦æ±‚3.8ï¼‰

éªŒè¯Pythonç‰ˆæœ¬ï¼š
```bash
python --version
# è¾“å‡ºç¤ºä¾‹ï¼šPython 3.9.13
```

#### 2.1.2 è™šæ‹Ÿç¯å¢ƒåˆ›å»º

ä½¿ç”¨`venv`åˆ›å»ºéš”ç¦»çš„å¼€å‘ç¯å¢ƒï¼š

```bash
# Windows
python -m venv venv
.\venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

æ¿€æ´»åï¼Œå‘½ä»¤è¡Œæç¤ºç¬¦ä¼šæ˜¾ç¤º`(venv)`å‰ç¼€ã€‚

#### 2.1.3 ä¾èµ–åŒ…å®‰è£…

åˆ›å»º`requirements.txt`æ–‡ä»¶ï¼š

```txt
# Core dependencies
python-dotenv==1.0.0        # ç¯å¢ƒå˜é‡ç®¡ç†
pydantic==2.5.0             # æ•°æ®éªŒè¯
loguru==0.7.2               # æ—¥å¿—ç®¡ç†

# HTTP clients
httpx==0.25.2               # ç°ä»£HTTPå®¢æˆ·ç«¯
aiohttp==3.9.1              # å¼‚æ­¥HTTPå®¢æˆ·ç«¯
requests==2.31.0            # ä¼ ç»ŸHTTPå®¢æˆ·ç«¯ï¼ˆå¤‡ç”¨ï¼‰

# Video processing
moviepy==1.0.3              # è§†é¢‘ç¼–è¾‘
ffmpeg-python==0.2.0        # FFmpeg Pythonç»‘å®š
Pillow==10.1.0              # å›¾åƒå¤„ç†

# AI/ML utilities
openai==1.3.0               # OpenAI SDKï¼ˆå¯é€‰ï¼Œç”¨äºGPTè¾…åŠ©ï¼‰
anthropic==0.7.0            # Anthropic SDKï¼ˆå¯é€‰ï¼‰

# Async utilities
asyncio==3.4.3
aiofiles==23.2.1            # å¼‚æ­¥æ–‡ä»¶æ“ä½œ

# Data processing
pandas==2.1.3               # æ•°æ®å¤„ç†
pyyaml==6.0.1               # YAMLé…ç½®æ–‡ä»¶

# Testing (optional)
pytest==7.4.3
pytest-asyncio==0.21.1

# Development tools
black==23.11.0              # ä»£ç æ ¼å¼åŒ–
flake8==6.1.0               # ä»£ç æ£€æŸ¥
mypy==1.7.1                 # ç±»å‹æ£€æŸ¥
```

å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

#### 2.1.4 FFmpegå®‰è£…

FFmpegæ˜¯è§†é¢‘å¤„ç†çš„æ ¸å¿ƒä¾èµ–ï¼Œéœ€è¦å•ç‹¬å®‰è£…ï¼š

**Windows:**
```bash
# ä½¿ç”¨Chocolatey
choco install ffmpeg

# æˆ–æ‰‹åŠ¨ä¸‹è½½
# 1. è®¿é—® https://ffmpeg.org/download.html
# 2. ä¸‹è½½Windowsç‰ˆæœ¬
# 3. è§£å‹åˆ°C:\ffmpeg
# 4. æ·»åŠ C:\ffmpeg\binåˆ°ç³»ç»ŸPATH
```

**macOS:**
```bash
brew install ffmpeg
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install ffmpeg
```

éªŒè¯å®‰è£…ï¼š
```bash
ffmpeg -version
# åº”æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

---

### 2.2 APIå¯†é’¥é…ç½®

#### 2.2.1 Nano Banana Pro APIé…ç½®

**è·å–APIå¯†é’¥ï¼š**
1. è®¿é—® Nano Banana Pro å®˜ç½‘ï¼ˆå‡è®¾ä¸º https://nanobananapro.comï¼‰
2. æ³¨å†Œè´¦å·å¹¶å®Œæˆå®åè®¤è¯
3. è¿›å…¥æ§åˆ¶å° â†’ APIå¯†é’¥ç®¡ç†
4. åˆ›å»ºæ–°çš„APIå¯†é’¥å¹¶å¤åˆ¶

**APIæ–‡æ¡£å‚è€ƒï¼š**
```
åŸºç¡€URL: https://api.nanobananapro.com/v1
ç«¯ç‚¹: /generate-image
æ–¹æ³•: POST
è®¤è¯: Bearer Token
```

#### 2.2.2 Veo3 APIé…ç½®

**è·å–APIå¯†é’¥ï¼š**
1. è®¿é—® Veo3 å®˜ç½‘ï¼ˆå‡è®¾ä¸º https://veo3.aiï¼‰
2. ç”³è¯·APIè®¿é—®æƒé™
3. è·å–APIå¯†é’¥å’ŒæœåŠ¡ç«¯ç‚¹

**APIæ–‡æ¡£å‚è€ƒï¼š**
```
åŸºç¡€URL: https://api.veo3.ai/v1
ç«¯ç‚¹: /image-to-video
æ–¹æ³•: POST
è®¤è¯: API Key Header
```

#### 2.2.3 ç¯å¢ƒå˜é‡ç®¡ç†

åˆ›å»º`.env`æ–‡ä»¶ï¼ˆâš ï¸ ä¸è¦æäº¤åˆ°Gitä»“åº“ï¼‰ï¼š

```bash
# .env
# Nano Banana Proé…ç½®
NANO_BANANA_API_KEY=your_nano_banana_api_key_here
NANO_BANANA_BASE_URL=https://api.nanobananapro.com/v1

# Veo3é…ç½®
VEO3_API_KEY=your_veo3_api_key_here
VEO3_BASE_URL=https://api.veo3.ai/v1

# åº”ç”¨é…ç½®
OUTPUT_DIR=./output
TEMP_DIR=./temp
LOG_LEVEL=INFO
MAX_CONCURRENT_REQUESTS=5

# å¯é€‰ï¼šOpenAIé…ç½®ï¼ˆç”¨äºå‰§æœ¬ä¼˜åŒ–ï¼‰
OPENAI_API_KEY=your_openai_key_here
```

åˆ›å»º`.env.example`ä½œä¸ºæ¨¡æ¿ï¼ˆå¯æäº¤åˆ°Gitï¼‰ï¼š

```bash
# .env.example
NANO_BANANA_API_KEY=
NANO_BANANA_BASE_URL=https://api.nanobananapro.com/v1
VEO3_API_KEY=
VEO3_BASE_URL=https://api.veo3.ai/v1
OUTPUT_DIR=./output
TEMP_DIR=./temp
LOG_LEVEL=INFO
MAX_CONCURRENT_REQUESTS=5
```

#### 2.2.4 é…ç½®åŠ è½½æ¨¡å—

åˆ›å»º`config/settings.py`ï¼š

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    """åº”ç”¨é…ç½®"""

    # Nano Banana Proé…ç½®
    nano_banana_api_key: str
    nano_banana_base_url: str = "https://api.nanobananapro.com/v1"

    # Veo3é…ç½®
    veo3_api_key: str
    veo3_base_url: str = "https://api.veo3.ai/v1"

    # åº”ç”¨é…ç½®
    output_dir: str = "./output"
    temp_dir: str = "./temp"
    log_level: str = "INFO"
    max_concurrent_requests: int = 5

    # å¯é€‰é…ç½®
    openai_api_key: Optional[str] = None

    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"

# å…¨å±€é…ç½®å®ä¾‹
settings = Settings()
```

ä½¿ç”¨é…ç½®ï¼š
```python
from config.settings import settings

print(settings.nano_banana_api_key)  # è®¿é—®é…ç½®é¡¹
```

---

### 2.3 é¡¹ç›®ç»“æ„

#### 2.3.1 å®Œæ•´ç›®å½•ç»“æ„

```
ai-drama-generator/
â”‚
â”œâ”€â”€ agents/                          # Agentæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_agent.py               # AgentåŸºç±»
â”‚   â”œâ”€â”€ script_parser_agent.py      # å‰§æœ¬è§£æAgent
â”‚   â”œâ”€â”€ image_generator_agent.py    # å›¾ç‰‡ç”ŸæˆAgent
â”‚   â”œâ”€â”€ video_generator_agent.py    # è§†é¢‘ç”ŸæˆAgent
â”‚   â”œâ”€â”€ video_composer_agent.py     # è§†é¢‘åˆæˆAgent
â”‚   â””â”€â”€ orchestrator_agent.py       # ä¸»æ§Agent
â”‚
â”œâ”€â”€ services/                        # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ nano_banana_service.py      # Nano Banana APIå°è£…
â”‚   â”œâ”€â”€ veo3_service.py             # Veo3 APIå°è£…
â”‚   â””â”€â”€ storage_service.py          # æ–‡ä»¶å­˜å‚¨æœåŠ¡
â”‚
â”œâ”€â”€ utils/                           # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py                   # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ retry.py                    # é‡è¯•æœºåˆ¶
â”‚   â”œâ”€â”€ validators.py               # æ•°æ®éªŒè¯
â”‚   â””â”€â”€ video_utils.py              # è§†é¢‘å¤„ç†å·¥å…·
â”‚
â”œâ”€â”€ config/                          # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py                 # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ models/                          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ script_models.py            # å‰§æœ¬æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ scene_models.py             # åœºæ™¯æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ agent_models.py             # Agenté€šä¿¡æ¨¡å‹
â”‚
â”œâ”€â”€ tests/                           # æµ‹è¯•æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_agents/
â”‚   â”œâ”€â”€ test_services/
â”‚   â””â”€â”€ test_integration/
â”‚
â”œâ”€â”€ examples/                        # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ basic_usage.py
â”‚   â”œâ”€â”€ advanced_features.py
â”‚   â””â”€â”€ sample_scripts/
â”‚       â””â”€â”€ demo_script.txt
â”‚
â”œâ”€â”€ output/                          # è¾“å‡ºç›®å½•ï¼ˆgitignoreï¼‰
â”œâ”€â”€ temp/                            # ä¸´æ—¶æ–‡ä»¶ï¼ˆgitignoreï¼‰
â”œâ”€â”€ logs/                            # æ—¥å¿—æ–‡ä»¶ï¼ˆgitignoreï¼‰
â”‚
â”œâ”€â”€ .env                             # ç¯å¢ƒå˜é‡ï¼ˆgitignoreï¼‰
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt                 # ä¾èµ–æ¸…å•
â”œâ”€â”€ README.md                        # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ main.py                          # ä¸»å…¥å£
â””â”€â”€ setup.py                         # å®‰è£…è„šæœ¬
```

#### 2.3.2 åˆå§‹åŒ–é¡¹ç›®ç»“æ„

ä½¿ç”¨ä»¥ä¸‹è„šæœ¬å¿«é€Ÿåˆ›å»ºé¡¹ç›®ç»“æ„ï¼š

```python
# scripts/init_project.py
import os

def create_project_structure():
    """åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„"""

    dirs = [
        "agents",
        "services",
        "utils",
        "config",
        "models",
        "tests/test_agents",
        "tests/test_services",
        "tests/test_integration",
        "examples/sample_scripts",
        "output",
        "temp",
        "logs"
    ]

    for dir_path in dirs:
        os.makedirs(dir_path, exist_ok=True)

        # åˆ›å»º__init__.py
        if not dir_path.startswith(("output", "temp", "logs", "examples")):
            init_file = os.path.join(dir_path, "__init__.py")
            if not os.path.exists(init_file):
                with open(init_file, "w") as f:
                    f.write(f'"""{dir_path.split("/")[0]} module"""\n')

    print("Project structure created successfully!")

if __name__ == "__main__":
    create_project_structure()
```

è¿è¡Œè„šæœ¬ï¼š
```bash
python scripts/init_project.py
```

#### 2.3.3 .gitignoreé…ç½®

åˆ›å»º`.gitignore`æ–‡ä»¶ï¼š

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
*.egg-info/
.installed.cfg
*.egg

# Virtual Environment
venv/
ENV/
env/

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# Environment variables
.env

# Output files
output/
temp/
logs/
*.mp4
*.avi
*.mov
*.png
*.jpg
*.jpeg

# OS
.DS_Store
Thumbs.db
```

#### 2.3.4 README.mdæ¨¡æ¿

```markdown
# AIçŸ­å‰§è‡ªåŠ¨åŒ–ç”Ÿæˆç³»ç»Ÿ

åŸºäºPythonå’Œå¤šAgentæ¶æ„çš„AIçŸ­å‰§è‡ªåŠ¨ç”Ÿæˆå·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ è‡ªåŠ¨å‰§æœ¬è§£æä¸åˆ†é•œè®¾è®¡
- ğŸ–¼ï¸ AIé©±åŠ¨çš„åˆ†é•œå›¾ç‰‡ç”Ÿæˆï¼ˆNano Banana Proï¼‰
- ğŸ¥ å›¾ç‰‡åˆ°è§†é¢‘çš„æ™ºèƒ½è½¬æ¢ï¼ˆVeo3ï¼‰
- âœ‚ï¸ è‡ªåŠ¨è§†é¢‘åˆæˆä¸åæœŸå¤„ç†
- ğŸ”„ æ–­ç‚¹ç»­ä¼ ä¸é”™è¯¯æ¢å¤
- ğŸ“Š å®æ—¶è¿›åº¦ç›‘æ§

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

\`\`\`bash
pip install -r requirements.txt
\`\`\`

### 2. é…ç½®APIå¯†é’¥

å¤åˆ¶`.env.example`ä¸º`.env`å¹¶å¡«å…¥ä½ çš„APIå¯†é’¥ã€‚

### 3. è¿è¡Œç¤ºä¾‹

\`\`\`python
python examples/basic_usage.py
\`\`\`

## é¡¹ç›®ç»“æ„

è§æ–‡æ¡£...

## æ–‡æ¡£

å®Œæ•´æ•™ç¨‹è¯·å‚è€ƒ[æ•™ç¨‹æ–‡æ¡£](./docs/)ã€‚

## è®¸å¯è¯

MIT License
```

---

## ä¸‹ä¸€æ­¥

ç¯å¢ƒå‡†å¤‡å®Œæˆåï¼Œè¯·ç»§ç»­é˜…è¯»**ç¬¬2éƒ¨åˆ†ï¼šæ ¸å¿ƒä»£ç å®ç°ï¼ˆå‰§æœ¬è§£æä¸å›¾ç‰‡ç”Ÿæˆï¼‰**ï¼Œå¼€å§‹æ„å»ºç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‚

---

**æˆæœ¬æç¤ºï¼š**
- Nano Banana Proå’ŒVeo3éƒ½æ˜¯æŒ‰ä½¿ç”¨é‡è®¡è´¹çš„APIæœåŠ¡
- å»ºè®®åœ¨æ­£å¼ä½¿ç”¨å‰å…ˆé˜…è¯»å®˜æ–¹å®šä»·æ–‡æ¡£
- å¼€å‘é˜¶æ®µå¯ä½¿ç”¨è¾ƒä½åˆ†è¾¨ç‡å’Œè¾ƒçŸ­æ—¶é•¿è¿›è¡Œæµ‹è¯•
- é¢„ä¼°æˆæœ¬ï¼šç”Ÿæˆä¸€ä¸ª5åˆ†é’ŸçŸ­å‰§çº¦éœ€è°ƒç”¨API 20-30æ¬¡

**ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜ï¼š**
- æœ¬æ•™ç¨‹åŸºäºPython 3.9ç¯å¢ƒå¼€å‘å’Œæµ‹è¯•
- FFmpegè¦æ±‚ç‰ˆæœ¬4.0+
- å¦‚é‡åˆ°ä¾èµ–å†²çªï¼Œå¯è°ƒæ•´`requirements.txt`ä¸­çš„ç‰ˆæœ¬å·
- Nano Banana Proå’ŒVeo3çš„APIå¯èƒ½æ›´æ–°ï¼Œè¯·ä»¥å®˜æ–¹æ–‡æ¡£ä¸ºå‡†
